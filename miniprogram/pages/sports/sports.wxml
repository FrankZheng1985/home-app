<!--pages/sports/sports.wxml - 3Dæç®€ç§‘æŠ€ç‰ˆ-->
<view class="page-container">
  <!-- å¤´éƒ¨åŒºåŸŸ -->
  <view class="hero-section">
    <view class="hero-bg-glow"></view>
    <view class="hero-content page-fade-in">
      <view class="steps-main">
        <text class="steps-label">ä»Šæ—¥æ­¥æ•°</text>
        <view class="steps-value-row">
          <text class="steps-value">{{todaySteps}}</text>
          <text class="steps-unit">æ­¥</text>
        </view>
        <view class="sync-btn-mini btn-active-feedback" bindtap="doSyncSteps">åŒæ­¥æ•°æ®</view>
      </view>
    </view>
  </view>

  <!-- è¿åŠ¨ç»Ÿè®¡å¡ç‰‡ (Glassmorphism Card) -->
  <view class="glass-card stats-card success-pop">
    <view class="stat-group">
      <view class="stat-item">
        <text class="stat-label">æœ¬å‘¨æ‰“å¡</text>
        <text class="stat-value">{{weekStats.totalDays || 0}}å¤©</text>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item">
        <text class="stat-label">è¿åŠ¨æ—¶é•¿</text>
        <text class="stat-value">{{weekStats.totalMinutes || 0}}min</text>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item">
        <text class="stat-label">è¿ç»­å¤©æ•°</text>
        <text class="stat-value">{{continuousDays || 0}}å¤©</text>
      </view>
    </view>
  </view>

  <!-- æ­¥æ•°å…‘æ¢å¡ç‰‡ -->
  <view class="glass-card redeem-card" wx:if="{{todaySteps >= 0}}">
    <view class="redeem-info">
      <view class="redeem-icon">ğŸ</view>
      <view class="redeem-text">
        <text class="redeem-title">æ­¥æ•°æ¢ç§¯åˆ†</text>
        <text class="redeem-desc">æ¯æ—¥5000æ­¥å¯é¢†50ç§¯åˆ†</text>
      </view>
    </view>
    <view class="redeem-action">
      <view class="redeem-btn btn-active-feedback {{todaySteps >= 5000 && !pointsRedeemed ? '' : 'disabled'}}" bindtap="{{todaySteps >= 5000 && !pointsRedeemed ? 'redeemPoints' : ''}}">
        {{pointsRedeemed ? 'å·²é¢†å–' : 'é¢†å–'}}
      </view>
    </view>
  </view>

  <!-- ä»Šæ—¥è¿åŠ¨è®°å½• -->
  <view class="section-header">
    <text class="section-title">ä»Šæ—¥è¿åŠ¨</text>
    <view class="add-btn-mini btn-active-feedback" bindtap="showAddModal">è®°å½•</view>
  </view>

  <view class="checkin-list">
    <view class="checkin-item glass-card" wx:for="{{todayRecords}}" wx:key="id">
      <view class="checkin-icon">{{item.icon || 'ğŸƒ'}}</view>
      <view class="checkin-info">
        <text class="checkin-name">{{item.sportType}}</text>
        <text class="checkin-desc">{{item.duration}}åˆ†é’Ÿ Â· {{item.calories || 0}}åƒå¡</text>
      </view>
      <text class="checkin-time">{{item.timeText}}</text>
    </view>
    <view class="empty-tip" wx:if="{{todayRecords.length === 0}}">ä»Šæ—¥æš‚æ— è¿åŠ¨è®°å½•</view>
  </view>

  <!-- è¿åŠ¨å†å² -->
  <view class="section-title">è¿åŠ¨å†å²</view>
  <view class="history-list">
    <view class="history-item glass-card" wx:for="{{historyRecords}}" wx:key="id">
      <view class="history-date">
        <text class="date-day">{{item.dayText}}</text>
        <text class="date-month">{{item.weekdayText}}</text>
      </view>
      <view class="history-info">
        <text class="history-name">{{item.sportType}}</text>
        <text class="history-desc">{{item.duration}}min Â· {{item.calories}}kcal</text>
      </view>
      <view class="history-steps" wx:if="{{item.steps}}">
        <text class="steps-num">{{item.steps}}</text>
        <text class="steps-unit">æ­¥</text>
      </view>
    </view>
  </view>

  <view class="safe-bottom"></view>

  <!-- è®°å½•è¿åŠ¨å¼¹çª— -->
  <view class="modal-mask {{showAddModal ? 'show' : ''}}" bindtap="closeAddModal">
    <view class="modal-content glass-card {{showAddModal ? 'show' : ''}}" catchtap="true">
      <view class="modal-header">
        <text class="modal-title">è®°å½•è¿åŠ¨</text>
        <view class="close-btn" bindtap="closeAddModal">Ã—</view>
      </view>
      
      <scroll-view scroll-y class="modal-body">
        <view class="form-item">
          <text class="form-label">é€‰æ‹©è¿åŠ¨</text>
          <view class="sport-type-grid">
            <view 
              wx:for="{{sportTypes}}" 
              wx:key="id" 
              class="sport-type-item {{selectedType.id === item.id ? 'active' : ''}}"
              bindtap="selectType"
              data-type="{{item}}"
            >
              <text class="sport-icon">{{item.icon}}</text>
              <text class="sport-name">{{item.name}}</text>
            </view>
            <view class="sport-type-item add-type" bindtap="showTypeModal">
              <text class="sport-icon">âš™ï¸</text>
              <text class="sport-name">ç®¡ç†</text>
            </view>
          </view>
        </view>

        <view class="form-item">
          <text class="form-label">è¿åŠ¨æ—¶é•¿ (åˆ†é’Ÿ)</text>
          <view class="duration-control">
            <view class="dur-btn btn-active-feedback" bindtap="decreaseDuration">-</view>
            <input class="dur-input" type="number" value="{{duration}}" bindinput="onDurationInput" />
            <view class="dur-btn btn-active-feedback" bindtap="increaseDuration">+</view>
          </view>
          <view class="quick-durations">
            <view class="dur-tag" bindtap="setQuickDuration" data-dur="15">15min</view>
            <view class="dur-tag" bindtap="setQuickDuration" data-dur="30">30min</view>
            <view class="dur-tag" bindtap="setQuickDuration" data-dur="45">45min</view>
            <view class="dur-tag" bindtap="setQuickDuration" data-dur="60">60min</view>
          </view>
        </view>

        <view class="form-item">
          <text class="form-label">é¢„ä¼°æ¶ˆè€—</text>
          <view class="calories-preview">
            <text class="cal-num">{{estimatedCalories}}</text>
            <text class="cal-unit">kcal</text>
          </view>
        </view>

        <view class="form-item">
          <text class="form-label">å¤‡æ³¨ (å¯é€‰)</text>
          <textarea class="form-textarea" placeholder="è®°å½•ä¸€ä¸‹ä»Šå¤©çš„å¿ƒæƒ…æˆ–çŠ¶æ€å§" value="{{remark}}" bindinput="onRemarkInput" />
        </view>
      </scroll-view>

      <view class="modal-footer">
        <view class="primary-btn submit-btn btn-active-feedback" bindtap="submitRecord">
          <text>ç¡®è®¤æ‰“å¡</text>
          <view class="btn-glow"></view>
        </view>
      </view>
    </view>
  </view>

  <!-- è¿åŠ¨ç±»å‹ç®¡ç†å¼¹çª— -->
  <view class="modal-mask {{showTypeModal ? 'show' : ''}}" bindtap="closeTypeModal">
    <view class="modal-content glass-card {{showTypeModal ? 'show' : ''}}" catchtap="true">
      <view class="modal-header">
        <text class="modal-title">è¿åŠ¨é¡¹ç›®ç®¡ç†</text>
        <view class="close-btn" bindtap="closeTypeModal">Ã—</view>
      </view>
      
      <scroll-view scroll-y class="modal-body">
        <view class="type-manage-list">
          <view class="type-manage-item" wx:for="{{sportTypes}}" wx:key="id">
            <text class="type-icon">{{item.icon}}</text>
            <text class="type-name">{{item.name}}</text>
            <text class="type-cal">{{item.caloriesPerMin}}kcal/min</text>
            <view class="delete-icon" bindtap="deleteType" data-id="{{item.id}}" wx:if="{{!item.isPreset}}">Ã—</view>
          </view>
        </view>

        <view class="add-type-form">
          <text class="form-label">æ·»åŠ è‡ªå®šä¹‰è¿åŠ¨</text>
          <view class="form-row">
            <input class="form-input" placeholder="è¿åŠ¨åç§°" value="{{newTypeName}}" bindinput="onNewTypeNameInput" />
            <input class="form-input" type="digit" placeholder="æ¯åˆ†é’Ÿçƒ­é‡" value="{{newTypeCalories}}" bindinput="onNewTypeCaloriesInput" />
          </view>
          <view class="primary-btn add-btn btn-active-feedback" bindtap="addNewType">
            <text>æ·»åŠ é¡¹ç›®</text>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>
</view>
