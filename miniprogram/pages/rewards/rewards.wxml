<!--pages/rewards/rewards.wxml-->
<view class="container rewards-container">
  <!-- 无家庭提示 -->
  <view class="empty-state" wx:if="{{!familyInfo}}">
    <view class="empty-icon">🏠</view>
    <view class="empty-text">请先加入或创建家庭</view>
  </view>

  <block wx:else>
    <!-- 积分价值说明 -->
    <view class="info-card card">
      <view class="info-icon">💡</view>
      <view class="info-content">
        <text class="info-title">积分说明</text>
        <text class="info-desc text-muted">完成家务获得积分，积分可兑换奖励。每个家务类型有对应的积分值。</text>
      </view>
    </view>

    <!-- 家务类型列表 -->
    <view class="types-section card">
      <view class="section-header flex-between">
        <text class="section-title">家务类型列表</text>
        <view class="add-btn text-primary" bindtap="openAddModal" wx:if="{{isAdmin}}">
          <text>+ 添加</text>
        </view>
      </view>

      <!-- 类型列表 -->
      <view class="types-list" wx:if="{{choreTypes.length > 0}}">
        <view class="type-item" wx:for="{{choreTypes}}" wx:key="id">
          <view class="type-main" data-item="{{item}}" bindtap="openEditModal">
            <text class="type-icon">{{item.icon || '🧹'}}</text>
            <view class="type-info">
              <text class="type-name">{{item.name}}</text>
              <text class="type-desc text-muted" wx:if="{{item.description}}">{{item.description}}</text>
            </view>
            <view class="type-points">
              <text class="points-value text-primary">+{{item.points}}</text>
              <text class="points-unit text-muted">积分</text>
            </view>
          </view>
          
          <view class="type-actions" wx:if="{{isAdmin}}">
            <text 
              class="action-delete text-error" 
              data-id="{{item.id}}"
              data-name="{{item.name}}"
              catchtap="deleteChoreType"
            >删除</text>
          </view>
        </view>
      </view>

      <!-- 空状态 -->
      <view class="empty-types" wx:else>
        <text class="text-muted">还没有设置家务类型</text>
        <button class="btn-primary btn-small mt-20" bindtap="openAddModal" wx:if="{{isAdmin}}">添加第一个</button>
      </view>
    </view>

    <!-- 非管理员提示 -->
    <view class="tip-card" wx:if="{{!isAdmin}}">
      <text class="text-muted">只有管理员可以设置家务类型和积分</text>
    </view>
  </block>

  <!-- 编辑弹窗 -->
  <view class="modal-mask" wx:if="{{showEditModal}}" bindtap="closeEditModal"></view>
  <view class="modal-content edit-modal" wx:if="{{showEditModal}}">
    <view class="modal-header">
      <text class="modal-title">{{editMode === 'add' ? '添加家务类型' : '编辑家务类型'}}</text>
      <text class="modal-close" bindtap="closeEditModal">×</text>
    </view>
    <view class="modal-body">
      <!-- 图标选择 -->
      <view class="form-group">
        <view class="form-label">选择图标</view>
        <view class="icon-grid">
          <view 
            class="icon-item {{editingType.icon === item ? 'selected' : ''}}" 
            wx:for="{{iconOptions}}" 
            wx:key="*this"
            data-icon="{{item}}"
            bindtap="selectIcon"
          >{{item}}</view>
        </view>
      </view>

      <!-- 名称输入 -->
      <view class="form-group">
        <view class="form-label">家务名称 <text class="required">*</text></view>
        <input 
          class="form-input" 
          placeholder="如：洗碗、拖地..."
          value="{{editingType.name}}"
          bindinput="onNameInput"
          maxlength="20"
        />
      </view>

      <!-- 积分输入 -->
      <view class="form-group">
        <view class="form-label">奖励积分 <text class="required">*</text></view>
        <input 
          class="form-input" 
          type="number"
          placeholder="请输入积分值"
          value="{{editingType.points}}"
          bindinput="onPointsInput"
        />
      </view>

      <!-- 描述输入 -->
      <view class="form-group">
        <view class="form-label">描述（选填）</view>
        <textarea 
          class="form-textarea" 
          placeholder="简单描述这项家务..."
          value="{{editingType.description}}"
          bindinput="onDescInput"
          maxlength="100"
        ></textarea>
      </view>
    </view>
    <view class="modal-footer">
      <button 
        class="btn-primary btn-block" 
        bindtap="saveChoreType"
        loading="{{isSubmitting}}"
        disabled="{{isSubmitting}}"
      >保存</button>
    </view>
  </view>
</view>
