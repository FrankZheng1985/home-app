<!--pages/rewards/rewards.wxml - 3D极简科技版-->
<view class="page-container">
  <!-- 头部区域 -->
  <view class="hero-section">
    <view class="hero-bg-glow"></view>
    <view class="hero-content page-fade-in">
      <view class="hero-title">奖励设置</view>
      <view class="hero-subtitle">Rewards Configuration</view>
    </view>
  </view>

  <!-- 积分价值卡片 (Glassmorphism Card) -->
  <view class="glass-card value-card success-pop" wx:if="{{familyInfo}}">
    <view class="value-main">
      <view class="value-info">
        <text class="value-label">当前积分价值</text>
        <view class="value-amount">
          <text class="amount-num">{{familyInfo.pointsValue || 0.5}}</text>
          <text class="amount-unit">元/积分</text>
        </view>
      </view>
      <view class="edit-btn btn-active-feedback" bindtap="editPointsValue" wx:if="{{isAdmin}}">修改</view>
    </view>
  </view>

  <!-- 家务类型列表 -->
  <view class="section-header">
    <text class="section-title">家务类型</text>
    <view class="add-btn-mini btn-active-feedback" bindtap="openAddModal" wx:if="{{isAdmin}}">添加</view>
  </view>

  <view class="types-list">
    <view class="type-item glass-card" wx:for="{{choreTypes}}" wx:key="id">
      <view class="type-header">
        <view class="type-icon">{{item.icon || '🧹'}}</view>
        <view class="type-info">
          <text class="type-name">{{item.name}}</text>
          <text class="type-points">+{{item.points}} 积分</text>
        </view>
        <view class="type-actions" wx:if="{{isAdmin}}">
          <view class="action-icon" catchtap="openEditModal" data-item="{{item}}">✏️</view>
          <view class="action-icon delete" catchtap="deleteChoreType" data-id="{{item.id}}" data-name="{{item.name}}">🗑️</view>
        </view>
      </view>
      <text class="type-desc" wx:if="{{item.description}}">{{item.description}}</text>
    </view>
  </view>

  <!-- 底部安全区域 -->
  <view class="safe-bottom"></view>

  <!-- 编辑家务类型弹窗 -->
  <view class="modal-mask {{showEditModal ? 'show' : ''}}" bindtap="closeEditModal">
    <view class="modal-content glass-card {{showEditModal ? 'show' : ''}}" catchtap="true">
      <view class="modal-header">
        <text class="modal-title">{{editMode === 'add' ? '添加家务' : '编辑家务'}}</text>
        <view class="close-btn" bindtap="closeEditModal">×</view>
      </view>
      
      <scroll-view scroll-y class="modal-body">
        <view class="form-item">
          <text class="form-label">家务名称</text>
          <input class="form-input" placeholder="如：洗碗、扫地" value="{{editingType.name}}" bindinput="onNameInput" />
        </view>

        <view class="form-item">
          <text class="form-label">选择图标</text>
          <view class="icon-grid">
            <view 
              wx:for="{{iconOptions}}" 
              wx:key="*this" 
              class="icon-item {{editingType.icon === item ? 'active' : ''}}"
              bindtap="selectIcon"
              data-icon="{{item}}"
            >{{item}}</view>
          </view>
        </view>

        <view class="form-item">
          <text class="form-label">奖励积分</text>
          <input class="form-input" type="number" placeholder="完成一次奖励多少积分？" value="{{editingType.points}}" bindinput="onPointsInput" />
        </view>

        <view class="form-item">
          <text class="form-label">描述 (可选)</text>
          <textarea class="form-textarea" placeholder="具体要求或注意事项" value="{{editingType.description}}" bindinput="onDescInput" />
        </view>
      </scroll-view>

      <view class="modal-footer">
        <view class="primary-btn submit-btn btn-active-feedback" bindtap="saveChoreType">
          <text>保存设置</text>
          <view class="btn-glow"></view>
        </view>
      </view>
    </view>
  </view>

  <!-- 积分价值设置弹窗 -->
  <view class="modal-mask {{showValueModal ? 'show' : ''}}" bindtap="closeValueModal">
    <view class="modal-content glass-card {{showValueModal ? 'show' : ''}}" catchtap="true">
      <view class="modal-header">
        <text class="modal-title">积分价值设置</text>
        <view class="close-btn" bindtap="closeValueModal">×</view>
      </view>
      
      <view class="modal-body">
        <view class="form-item">
          <text class="form-label">每积分价值 (元)</text>
          <input class="form-input" type="digit" placeholder="如：0.5" value="{{newPointsValue}}" bindinput="onValueInput" />
          <text class="form-tip">💡 用于计算积分对应的现金价值，建议设为 0.1 ~ 1.0 之间</text>
        </view>
      </view>

      <view class="modal-footer">
        <view class="primary-btn submit-btn btn-active-feedback" bindtap="savePointsValue">
          <text>确认修改</text>
          <view class="btn-glow"></view>
        </view>
      </view>
    </view>
  </view>
</view>
