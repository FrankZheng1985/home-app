<!--pages/chores/chores.wxml-->
<view class="container chores-container">
  <!-- æ ‡ç­¾åˆ‡æ¢ -->
  <view class="tabs">
    <view class="tab-item {{activeTab === 'record' ? 'active' : ''}}" 
          data-tab="record" 
          bindtap="switchTab">
      è®°å½•å®¶åŠ¡
    </view>
    <view class="tab-item {{activeTab === 'history' ? 'active' : ''}}" 
          data-tab="history" 
          bindtap="switchTab">
      å†å²è®°å½•
    </view>
  </view>

  <!-- è®°å½•å®¶åŠ¡ -->
  <view class="tab-content" wx:if="{{activeTab === 'record'}}">
    <!-- æ— å®¶åº­æç¤º -->
    <view class="empty-state" wx:if="{{!familyInfo}}">
      <view class="empty-icon">ğŸ </view>
      <view class="empty-text">è¯·å…ˆåŠ å…¥æˆ–åˆ›å»ºå®¶åº­</view>
    </view>

    <!-- å®¶åŠ¡ç±»å‹åˆ—è¡¨ -->
    <block wx:elif="{{choreTypes.length > 0}}">
      <view class="section-title">é€‰æ‹©å®¶åŠ¡ç±»å‹</view>
      <view class="chore-types-grid">
        <view class="chore-type-item" 
              wx:for="{{choreTypes}}" 
              wx:key="id"
              data-item="{{item}}"
              bindtap="selectChoreType">
          <view class="chore-icon">{{item.icon || 'ğŸ§¹'}}</view>
          <view class="chore-name">{{item.name}}</view>
          <view class="chore-points">+{{item.points}}åˆ†</view>
        </view>
      </view>

      <view class="add-type-tip" bindtap="goToRewards">
        <text class="text-primary">+ æ·»åŠ æ›´å¤šå®¶åŠ¡ç±»å‹</text>
      </view>
    </block>

    <!-- æ— å®¶åŠ¡ç±»å‹ -->
    <view class="empty-state" wx:else>
      <view class="empty-icon">ğŸ“</view>
      <view class="empty-text">è¿˜æ²¡æœ‰è®¾ç½®å®¶åŠ¡ç±»å‹</view>
      <button class="btn-primary btn-small empty-action" bindtap="goToRewards">å»è®¾ç½®</button>
    </view>
  </view>

  <!-- å†å²è®°å½• -->
  <view class="tab-content" wx:if="{{activeTab === 'history'}}">
    <view class="records-list" wx:if="{{choreRecords.length > 0}}">
      <view class="record-item card" wx:for="{{choreRecords}}" wx:key="id">
        <view class="record-header">
          <view class="record-user">
            <image class="record-avatar avatar-small" src="{{item.user.avatarUrl || '/assets/images/default-avatar.png'}}"></image>
            <text class="record-username">{{item.user.nickname}}</text>
          </view>
          <view class="record-points text-primary">+{{item.points}}åˆ†</view>
        </view>
        <view class="record-body">
          <view class="record-chore">
            <text class="chore-icon-small">{{item.choreType.icon || 'ğŸ§¹'}}</text>
            <text class="chore-name">{{item.choreType.name}}</text>
          </view>
          <view class="record-remark text-muted" wx:if="{{item.remark}}">{{item.remark}}</view>
        </view>
        <view class="record-footer">
          <text class="record-time text-muted">{{item.createdAtText}}</text>
        </view>
      </view>

      <view class="load-more" wx:if="{{hasMore}}">
        <text class="text-muted">ä¸Šæ‹‰åŠ è½½æ›´å¤š</text>
      </view>
      <view class="no-more" wx:else>
        <text class="text-muted">æ²¡æœ‰æ›´å¤šäº†</text>
      </view>
    </view>

    <view class="empty-state" wx:else>
      <view class="empty-icon">ğŸ“‹</view>
      <view class="empty-text">è¿˜æ²¡æœ‰å®¶åŠ¡è®°å½•</view>
    </view>
  </view>

  <!-- è®°å½•å¼¹çª— -->
  <view class="modal-mask" wx:if="{{showRecordModal}}" bindtap="closeRecordModal"></view>
  <view class="modal-content" wx:if="{{showRecordModal}}">
    <view class="modal-header">
      <text class="modal-title">è®°å½•å®¶åŠ¡</text>
      <text class="modal-close" bindtap="closeRecordModal">Ã—</text>
    </view>
    <view class="modal-body">
      <view class="selected-chore">
        <view class="chore-icon-large">{{selectedChoreType.icon || 'ğŸ§¹'}}</view>
        <view class="chore-info">
          <text class="chore-name">{{selectedChoreType.name}}</text>
          <text class="chore-points text-primary">+{{selectedChoreType.points}}ç§¯åˆ†</text>
        </view>
      </view>

      <view class="form-group">
        <view class="form-label">å¤‡æ³¨ï¼ˆé€‰å¡«ï¼‰</view>
        <textarea 
          class="form-textarea" 
          placeholder="æ·»åŠ å¤‡æ³¨..."
          value="{{remark}}"
          bindinput="onRemarkInput"
          maxlength="200"
        ></textarea>
      </view>
    </view>
    <view class="modal-footer">
      <button 
        class="btn-primary btn-block" 
        bindtap="submitRecord"
        loading="{{isSubmitting}}"
        disabled="{{isSubmitting}}"
      >ç¡®è®¤æäº¤</button>
    </view>
  </view>
</view>
