<!--pages/profile/redeem-review.wxml - 3D极简科技版-->
<view class="page-container">
  <!-- 头部区域 -->
  <view class="hero-section">
    <view class="hero-bg-glow"></view>
    <view class="hero-content page-fade-in">
      <view class="hero-title">兑现审核</view>
      <view class="hero-subtitle">Review Points Redemption</view>
    </view>
  </view>

  <!-- 筛选标签 (Glassmorphism Tabs) -->
  <view class="tabs-wrapper">
    <view class="glass-card tabs tabs-4">
      <view class="tab-item {{filterStatus === 'pending' ? 'active' : ''}}" data-status="pending" bindtap="switchFilter">待审</view>
      <view class="tab-item {{filterStatus === 'approved' ? 'active' : ''}}" data-status="approved" bindtap="switchFilter">通过</view>
      <view class="tab-item {{filterStatus === 'rejected' ? 'active' : ''}}" data-status="rejected" bindtap="switchFilter">拒绝</view>
      <view class="tab-item {{filterStatus === 'all' ? 'active' : ''}}" data-status="all" bindtap="switchFilter">全部</view>
      <view class="tab-indicator {{filterStatus === 'approved' ? 'pos-2' : (filterStatus === 'rejected' ? 'pos-3' : (filterStatus === 'all' ? 'pos-4' : ''))}}"></view>
    </view>
  </view>

  <!-- 申请列表 -->
  <view class="requests-list">
    <view class="request-item glass-card success-pop" wx:for="{{requests}}" wx:key="id">
      <view class="request-header">
        <image class="user-avatar" src="{{item.user.avatarUrl || '/assets/images/default-avatar.png'}}" mode="aspectFill" />
        <view class="user-info">
          <text class="user-name">{{item.user.nickname}}</text>
          <text class="request-time">{{item.createdAtText}}</text>
        </view>
        <view class="request-status {{item.status}}">{{item.status === 'pending' ? '待审核' : (item.status === 'approved' ? '已通过' : '已拒绝')}}</view>
      </view>
      <view class="request-body">
        <view class="request-main">
          <text class="points-value">{{item.points}} 积分</text>
          <text class="amount-value">≈ ¥{{item.amount}}</text>
        </view>
        <text class="request-remark" wx:if="{{item.remark}}">{{item.remark}}</text>
      </view>
      <view class="review-actions" wx:if="{{item.status === 'pending'}}">
        <view class="action-btn approve" bindtap="showReviewModal" data-request="{{item}}">审核</view>
      </view>
    </view>
    
    <view class="empty-tip" wx:if="{{requests.length === 0}}">暂无相关申请记录</view>
  </view>

  <!-- 审核弹窗 -->
  <view class="modal-mask {{showReviewModal ? 'show' : ''}}" bindtap="closeReviewModal">
    <view class="modal-content glass-card {{showReviewModal ? 'show' : ''}}" catchtap="preventClose">
      <view class="modal-header">
        <text class="modal-title">审核兑现申请</text>
        <view class="close-btn" bindtap="closeReviewModal">×</view>
      </view>
      
      <scroll-view scroll-y class="modal-body">
        <view class="request-info-box">
          <view class="info-row">
            <text class="info-label">申请人</text>
            <text class="info-value">{{currentRequest.user.nickname}}</text>
          </view>
          <view class="info-row">
            <text class="info-label">申请积分</text>
            <text class="info-value highlight">{{currentRequest.points}}</text>
          </view>
          <view class="info-row">
            <text class="info-label">预计支付</text>
            <text class="info-value amount">¥{{currentRequest.amount}}</text>
          </view>
          <view class="info-row" wx:if="{{currentRequest.remark}}">
            <text class="info-label">备注</text>
            <text class="info-value">{{currentRequest.remark}}</text>
          </view>
        </view>

        <view class="form-item" wx:if="{{!isReviewing}}">
          <text class="form-label">拒绝原因 (仅在拒绝时填写)</text>
          <textarea class="form-textarea" placeholder="请输入拒绝原因..." value="{{rejectReason}}" bindinput="onRejectReasonInput" />
        </view>
      </scroll-view>

      <view class="modal-footer review-footer">
        <view class="action-btn reject btn-active-feedback {{isReviewing ? 'disabled' : ''}}" bindtap="rejectRequest">拒绝</view>
        <view class="primary-btn approve-btn btn-active-feedback {{isReviewing ? 'disabled' : ''}}" bindtap="approveRequest">
          <text>{{isReviewing ? '处理中...' : '批准通过'}}</text>
          <view class="btn-glow"></view>
        </view>
      </view>
    </view>
  </view>

  <view class="safe-bottom"></view>
</view>
