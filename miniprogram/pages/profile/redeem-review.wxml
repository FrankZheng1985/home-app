<!--pages/profile/redeem-review.wxml - ç§¯åˆ†å…‘ç°å®¡æ ¸é¡µé¢-->
<view class="review-page">
  <!-- ç­›é€‰æ ‡ç­¾ -->
  <view class="filter-tabs-bar">
    <view class="filter-tab {{filterStatus === 'pending' ? 'active' : ''}}" 
          data-status="pending" bindtap="switchFilter">
      å¾…å®¡æ ¸
    </view>
    <view class="filter-tab {{filterStatus === 'approved' ? 'active' : ''}}" 
          data-status="approved" bindtap="switchFilter">
      å·²é€šè¿‡
    </view>
    <view class="filter-tab {{filterStatus === 'rejected' ? 'active' : ''}}" 
          data-status="rejected" bindtap="switchFilter">
      å·²æ‹’ç»
    </view>
    <view class="filter-tab {{filterStatus === 'all' ? 'active' : ''}}" 
          data-status="all" bindtap="switchFilter">
      å…¨éƒ¨
    </view>
  </view>

  <!-- ç”³è¯·åˆ—è¡¨ -->
  <view class="requests-list" wx:if="{{requests.length > 0}}">
    <view class="request-card" wx:for="{{requests}}" wx:key="id">
      <view class="request-header">
        <view class="user-info">
          <image class="user-avatar" src="{{item.user.avatarUrl || '/assets/images/default-avatar.png'}}"></image>
          <text class="user-name">{{item.user.nickname}}</text>
        </view>
        <view class="request-status {{item.status}}">
          {{item.status === 'pending' ? 'å¾…å®¡æ ¸' : (item.status === 'approved' ? 'å·²é€šè¿‡' : 'å·²æ‹’ç»')}}
        </view>
      </view>
      
      <view class="request-body">
        <view class="request-main">
          <text class="points-label">ç”³è¯·å…‘ç°</text>
          <text class="points-value">{{item.points}} ç§¯åˆ†</text>
          <text class="amount-value">â‰ˆ Â¥{{item.amount}}</text>
        </view>
        <view class="request-remark" wx:if="{{item.remark}}">
          <text class="remark-label">å¤‡æ³¨ï¼š</text>
          <text class="remark-text">{{item.remark}}</text>
        </view>
        <view class="request-reject" wx:if="{{item.status === 'rejected' && item.rejectReason}}">
          <text class="reject-label">æ‹’ç»åŸå› ï¼š</text>
          <text class="reject-text">{{item.rejectReason}}</text>
        </view>
      </view>
      
      <view class="request-footer">
        <text class="request-time">ç”³è¯·æ—¶é—´ï¼š{{item.createdAtText}}</text>
        <text class="reviewed-time" wx:if="{{item.reviewedAtText}}">
          å®¡æ ¸æ—¶é—´ï¼š{{item.reviewedAtText}}
        </text>
      </view>
      
      <!-- å¾…å®¡æ ¸çš„æ˜¾ç¤ºæ“ä½œæŒ‰é’® -->
      <view class="request-actions" wx:if="{{item.status === 'pending'}}">
        <button class="action-btn reject" data-request="{{item}}" bindtap="showReviewModal">
          å®¡æ ¸
        </button>
      </view>
    </view>

    <view class="load-more" wx:if="{{hasMore}}">
      <text>{{isLoading ? 'åŠ è½½ä¸­...' : 'ä¸Šæ‹‰åŠ è½½æ›´å¤š'}}</text>
    </view>
    <view class="no-more" wx:if="{{!hasMore}}">
      <text>æ²¡æœ‰æ›´å¤šäº†</text>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:else>
    <view class="empty-icon animate-float">ğŸ“‹</view>
    <view class="empty-title">æš‚æ— å…‘ç°ç”³è¯·</view>
    <view class="empty-desc">
      {{filterStatus === 'pending' ? 'å½“å‰æ²¡æœ‰å¾…å®¡æ ¸çš„ç”³è¯·' : 'æš‚æ— ç›¸å…³ç”³è¯·è®°å½•'}}
    </view>
  </view>

  <!-- å®¡æ ¸å¼¹çª— -->
  <view class="modal-overlay {{showReviewModal ? 'show' : ''}}" bindtap="closeReviewModal">
    <view class="modal-container" catchtap="preventClose">
      <view class="modal-header">
        <text class="modal-title">ğŸ“ å®¡æ ¸å…‘ç°ç”³è¯·</text>
        <view class="modal-close" bindtap="closeReviewModal">Ã—</view>
      </view>
      <view class="modal-body" wx:if="{{currentRequest}}">
        <view class="review-info">
          <view class="info-row">
            <text class="info-label">ç”³è¯·äºº</text>
            <text class="info-value">{{currentRequest.user.nickname}}</text>
          </view>
          <view class="info-row">
            <text class="info-label">å…‘ç°ç§¯åˆ†</text>
            <text class="info-value highlight">{{currentRequest.points}} ç§¯åˆ†</text>
          </view>
          <view class="info-row">
            <text class="info-label">å¯¹åº”é‡‘é¢</text>
            <text class="info-value highlight">Â¥{{currentRequest.amount}}</text>
          </view>
          <view class="info-row" wx:if="{{currentRequest.remark}}">
            <text class="info-label">å¤‡æ³¨</text>
            <text class="info-value">{{currentRequest.remark}}</text>
          </view>
        </view>
        
        <view class="review-tips">
          <text class="tip-icon">ğŸ’¡</text>
          <text class="tip-text">é€šè¿‡åè¯·çº¿ä¸‹æ”¯ä»˜ç°é‡‘ç»™ç”³è¯·äººï¼Œç§¯åˆ†å°†è‡ªåŠ¨æ‰£é™¤</text>
        </view>
        
        <view class="reject-reason-section">
          <view class="form-label">æ‹’ç»åŸå› ï¼ˆæ‹’ç»æ—¶å¿…å¡«ï¼‰</view>
          <textarea 
            class="reject-input" 
            placeholder="å¦‚éœ€æ‹’ç»ï¼Œè¯·å¡«å†™åŸå› ..."
            value="{{rejectReason}}"
            bindinput="onRejectReasonInput"
            maxlength="200"
          ></textarea>
        </view>
      </view>
      <view class="modal-footer">
        <button 
          class="reject-btn" 
          bindtap="rejectRequest"
          disabled="{{isReviewing}}"
        >
          æ‹’ç»
        </button>
        <button 
          class="approve-btn" 
          bindtap="approveRequest"
          disabled="{{isReviewing}}"
        >
          {{isReviewing ? 'å¤„ç†ä¸­...' : 'é€šè¿‡å¹¶æ‰£åˆ†'}}
        </button>
      </view>
    </view>
  </view>
</view>
