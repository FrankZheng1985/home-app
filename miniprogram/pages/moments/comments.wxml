<!--pages/moments/comments.wxml-->
<view class="comments-page">
  <!-- åŸå¸–å†…å®¹ -->
  <view class="post-card" wx:if="{{post}}">
    <view class="post-header">
      <image class="author-avatar" src="{{post.user.avatarUrl || '/assets/images/default-avatar.png'}}"></image>
      <view class="author-info">
        <text class="author-name">{{post.user.nickname || 'ç”¨æˆ·'}}</text>
        <text class="post-time">{{post.createdAtText}}</text>
      </view>
    </view>
    <view class="post-content">{{post.content}}</view>
    <view class="post-images" wx:if="{{post.images && post.images.length > 0}}">
      <image 
        wx:for="{{post.images}}" 
        wx:key="*this" 
        class="post-image" 
        src="{{item}}" 
        mode="aspectFill"
        bindtap="previewImage"
        data-urls="{{post.images}}"
        data-current="{{item}}"
      ></image>
    </view>
    <view class="post-stats">
      <text class="stat-item">â¤ï¸ {{post.likesCount || 0}} èµ</text>
      <text class="stat-item">ğŸ’¬ {{comments.length}} è¯„è®º</text>
    </view>
  </view>

  <!-- è¯„è®ºåˆ—è¡¨ -->
  <view class="comments-section">
    <view class="section-title">å…¨éƒ¨è¯„è®º ({{comments.length}})</view>
    
    <view class="comments-list" wx:if="{{comments.length > 0}}">
      <view class="comment-item" wx:for="{{comments}}" wx:key="id">
        <image class="comment-avatar" src="{{item.author.avatarUrl || '/assets/images/default-avatar.png'}}"></image>
        <view class="comment-body">
          <view class="comment-header">
            <text class="comment-author">{{item.author.nickname || 'ç”¨æˆ·'}}</text>
            <text class="comment-time">{{item.createdAtText}}</text>
          </view>
          <text class="comment-content">{{item.content}}</text>
          <!-- åˆ é™¤æŒ‰é’®ï¼ˆè‡ªå·±çš„è¯„è®ºå¯åˆ é™¤ï¼‰ -->
          <view 
            class="comment-delete" 
            wx:if="{{item.author.id === currentUserId}}"
            bindtap="deleteComment"
            data-id="{{item.id}}"
            data-index="{{index}}"
          >
            åˆ é™¤
          </view>
        </view>
      </view>
    </view>
    
    <view class="empty-comments" wx:else>
      <text class="empty-icon">ğŸ’¬</text>
      <text class="empty-text">è¿˜æ²¡æœ‰è¯„è®ºï¼Œå¿«æ¥æŠ¢æ²™å‘å§~</text>
    </view>
  </view>

  <!-- åº•éƒ¨è¯„è®ºè¾“å…¥ -->
  <view class="comment-input-bar">
    <input 
      class="comment-input" 
      placeholder="å†™è¯„è®º..." 
      value="{{commentContent}}"
      bindinput="onCommentInput"
      bindconfirm="submitComment"
      confirm-type="send"
      focus="{{inputFocus}}"
    />
    <button 
      class="send-btn {{commentContent.trim() ? 'active' : ''}}" 
      bindtap="submitComment"
      disabled="{{!commentContent.trim() || isSubmitting}}"
    >
      å‘é€
    </button>
  </view>
</view>

