<!--pages/moments/moments.wxml-->
<view class="container moments-container">
  <!-- æ— å®¶åº­æç¤º -->
  <view class="empty-state" wx:if="{{!familyInfo}}">
    <view class="empty-icon">ğŸ </view>
    <view class="empty-text">è¯·å…ˆåŠ å…¥æˆ–åˆ›å»ºå®¶åº­</view>
  </view>

  <block wx:else>
    <!-- å‘å¸ƒæŒ‰é’® -->
    <view class="publish-btn" bindtap="openPublishModal">
      <text class="publish-icon">âœï¸</text>
      <text class="publish-text">åˆ†äº«ä¸€ä¸‹...</text>
    </view>

    <!-- åŠ¨æ€åˆ—è¡¨ -->
    <view class="posts-list" wx:if="{{posts.length > 0}}">
      <view class="post-item card" wx:for="{{posts}}" wx:key="id">
        <!-- ä½œè€…ä¿¡æ¯ -->
        <view class="post-header">
          <view class="post-author">
            <image 
              class="author-avatar avatar-medium" 
              src="{{item.isAnonymous ? '/assets/images/default-avatar.png' : item.user.avatarUrl}}"
            ></image>
            <view class="author-info">
              <text class="author-name">{{item.isAnonymous ? 'åŒ¿åå®¶äºº' : item.user.nickname}}</text>
              <text class="post-time text-muted">{{item.createdAtText}}</text>
            </view>
          </view>
          
          <!-- åˆ é™¤æŒ‰é’®ï¼ˆä»…è‡ªå·±çš„åŠ¨æ€å¯è§ï¼‰ -->
          <view 
            class="post-delete" 
            wx:if="{{item.userId === currentUserId}}"
            data-id="{{item.id}}"
            data-index="{{index}}"
            bindtap="deletePost"
          >
            <text class="text-muted">åˆ é™¤</text>
          </view>
        </view>

        <!-- å†…å®¹ -->
        <view class="post-content">{{item.content}}</view>

        <!-- å›¾ç‰‡ï¼ˆå¦‚æœæœ‰ï¼‰ -->
        <view class="post-images" wx:if="{{item.images && item.images.length > 0}}">
          <image 
            wx:for="{{item.images}}" 
            wx:for-item="img"
            wx:key="*this"
            class="post-image" 
            src="{{img}}" 
            mode="aspectFill"
          ></image>
        </view>

        <!-- äº’åŠ¨åŒº -->
        <view class="post-actions">
          <view 
            class="action-item {{item.isLiked ? 'liked' : ''}}" 
            data-id="{{item.id}}"
            data-index="{{index}}"
            bindtap="toggleLike"
          >
            <text class="action-icon">{{item.isLiked ? 'â¤ï¸' : 'ğŸ¤'}}</text>
            <text class="action-count">{{item.likesCount || 0}}</text>
          </view>
          <view 
            class="action-item"
            data-id="{{item.id}}"
            bindtap="viewComments"
          >
            <text class="action-icon">ğŸ’¬</text>
            <text class="action-count">{{item.commentsCount || 0}}</text>
          </view>
        </view>
      </view>

      <!-- åŠ è½½æ›´å¤š -->
      <view class="load-more" wx:if="{{hasMore}}">
        <text class="text-muted">ä¸Šæ‹‰åŠ è½½æ›´å¤š</text>
      </view>
      <view class="no-more" wx:else>
        <text class="text-muted">æ²¡æœ‰æ›´å¤šäº†</text>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:else>
      <view class="empty-icon">ğŸ“¢</view>
      <view class="empty-text">è¿˜æ²¡æœ‰åŠ¨æ€ï¼Œæ¥å‘å¸ƒç¬¬ä¸€æ¡å§ï¼</view>
    </view>
  </block>

  <!-- å‘å¸ƒå¼¹çª— -->
  <view class="modal-mask" wx:if="{{showPublishModal}}" bindtap="closePublishModal"></view>
  <view class="modal-content publish-modal" wx:if="{{showPublishModal}}">
    <view class="modal-header">
      <text class="modal-cancel" bindtap="closePublishModal">å–æ¶ˆ</text>
      <text class="modal-title">å‘å¸ƒåŠ¨æ€</text>
      <text 
        class="modal-confirm {{postContent.trim() ? 'active' : ''}}" 
        bindtap="publishPost"
      >å‘å¸ƒ</text>
    </view>
    <view class="modal-body">
      <textarea 
        class="publish-textarea" 
        placeholder="åˆ†äº«ä½ çš„å¿ƒæƒ…æˆ–æƒ³æ³•..."
        value="{{postContent}}"
        bindinput="onContentInput"
        maxlength="500"
        auto-focus
      ></textarea>
      
      <view class="publish-options">
        <view class="option-item" bindtap="toggleAnonymous">
          <text class="option-icon">{{isAnonymous ? 'ğŸ™ˆ' : 'ğŸ‘¤'}}</text>
          <text class="option-text">{{isAnonymous ? 'åŒ¿åå‘å¸ƒ' : 'å®åå‘å¸ƒ'}}</text>
          <view class="option-switch {{isAnonymous ? 'on' : ''}}"></view>
        </view>
      </view>
      
      <view class="publish-tip text-muted" wx:if="{{isAnonymous}}">
        åŒ¿åå‘å¸ƒï¼šå®¶äººåªèƒ½çœ‹åˆ°å†…å®¹ï¼Œä¸ä¼šæ˜¾ç¤ºä½ çš„èº«ä»½
      </view>
    </view>
  </view>
</view>
