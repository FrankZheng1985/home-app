<!--pages/family/family.wxml-->
<view class="container family-container">
  <!-- æ— å®¶åº­ -->
  <view class="empty-state" wx:if="{{!familyInfo}}">
    <view class="empty-icon">ğŸ </view>
    <view class="empty-text">è¿˜æ²¡æœ‰åŠ å…¥å®¶åº­</view>
    <navigator url="/pages/family/create" class="btn-primary btn-small mt-20">åˆ›å»ºå®¶åº­</navigator>
    <navigator url="/pages/family/join" class="btn-secondary btn-small mt-20">åŠ å…¥å®¶åº­</navigator>
  </view>

  <block wx:else>
    <!-- å®¶åº­ä¿¡æ¯å¡ç‰‡ -->
    <view class="family-info-card card">
      <view class="family-header">
        <view class="family-icon">ğŸ </view>
        <view class="family-detail">
          <text class="family-name">{{familyInfo.name}}</text>
          <text class="family-members text-muted">{{members.length}}ä½å®¶åº­æˆå‘˜</text>
        </view>
      </view>
      
      <view class="family-actions">
        <view class="action-btn" bindtap="showInvite">
          <text class="action-icon">ğŸ“¨</text>
          <text class="action-text">é‚€è¯·æˆå‘˜</text>
        </view>
        <view class="action-btn" bindtap="goToRewards" wx:if="{{isAdmin}}">
          <text class="action-icon">âš™ï¸</text>
          <text class="action-text">å¥–åŠ±è®¾ç½®</text>
        </view>
      </view>
    </view>

    <!-- æˆå‘˜åˆ—è¡¨ -->
    <view class="members-section card">
      <view class="section-header">
        <text class="section-title">å®¶åº­æˆå‘˜</text>
      </view>
      
      <view class="members-list">
        <view class="member-item" wx:for="{{members}}" wx:key="id">
          <image 
            class="member-avatar avatar-medium" 
            src="{{item.user.avatarUrl || '/assets/images/default-avatar.png'}}"
          ></image>
          <view class="member-info">
            <view class="member-name-row">
              <text class="member-name">{{item.user.nickname}}</text>
              <view class="role-tag {{item.role === 'owner' ? 'owner' : item.role === 'admin' ? 'admin' : ''}}">
                {{item.role === 'owner' ? 'åˆ›å»ºè€…' : item.role === 'admin' ? 'ç®¡ç†å‘˜' : 'æˆå‘˜'}}
              </view>
            </view>
            <text class="member-points text-muted">ç´¯è®¡ç§¯åˆ†ï¼š{{item.totalPoints || 0}}</text>
          </view>
          
          <!-- ç®¡ç†æ“ä½œ -->
          <view class="member-actions" wx:if="{{isAdmin && item.userId !== currentUserId && item.role !== 'owner'}}">
            <view 
              class="action-menu-btn" 
              data-member-id="{{item.id}}"
              data-member-name="{{item.user.nickname}}"
              catchtap="removeMember"
            >
              <text class="text-error">ç§»é™¤</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- é€€å‡ºå®¶åº­ -->
    <view class="leave-section">
      <button class="leave-btn" bindtap="leaveFamily">é€€å‡ºå®¶åº­</button>
    </view>
  </block>

  <!-- é‚€è¯·å¼¹çª— -->
  <view class="modal-mask" wx:if="{{showInviteModal}}" bindtap="closeInviteModal"></view>
  <view class="modal-content invite-modal" wx:if="{{showInviteModal}}">
    <view class="modal-header">
      <text class="modal-title">é‚€è¯·å®¶äººåŠ å…¥</text>
      <text class="modal-close" bindtap="closeInviteModal">Ã—</text>
    </view>
    <view class="modal-body">
      <view class="invite-code-section">
        <text class="invite-label">é‚€è¯·ç </text>
        <view class="invite-code-box">
          <text class="invite-code">{{inviteCode}}</text>
          <button class="copy-btn btn-small btn-primary" bindtap="copyInviteCode">å¤åˆ¶</button>
        </view>
      </view>
      
      <view class="divider-text">
        <text class="divider-line"></text>
        <text class="divider-text-content text-muted">æˆ–</text>
        <text class="divider-line"></text>
      </view>
      
      <button class="btn-outline btn-block" bindtap="generateQRCode">
        ç”Ÿæˆé‚€è¯·äºŒç»´ç 
      </button>
    </view>
  </view>
</view>
