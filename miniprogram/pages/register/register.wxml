<!--pages/register/register.wxml-->
<view class="container register-container">
  <!-- 步骤指示器 -->
  <view class="step-indicator">
    <view class="step {{step >= 1 ? 'active' : ''}}">
      <view class="step-dot">1</view>
      <view class="step-label">基本信息</view>
    </view>
    <view class="step-line {{step >= 2 ? 'active' : ''}}"></view>
    <view class="step {{step >= 2 ? 'active' : ''}}">
      <view class="step-dot">2</view>
      <view class="step-label">喜好设置</view>
    </view>
  </view>

  <!-- 步骤1: 基本信息 -->
  <view class="step-content" wx:if="{{step === 1}}">
    <view class="step-title">完善您的信息</view>
    <view class="step-desc">让家人更好地认识您</view>

    <!-- 头像选择 -->
    <view class="avatar-section">
      <button class="avatar-btn" open-type="chooseAvatar" bindchooseavatar="chooseAvatar">
        <image class="avatar-img" 
               src="{{userInfo.avatarUrl || '/assets/images/default-avatar.png'}}" 
               mode="aspectFill"></image>
        <view class="avatar-edit-icon">📷</view>
      </button>
      <view class="avatar-tip">点击更换头像</view>
    </view>

    <!-- 昵称输入 -->
    <view class="form-section">
      <view class="form-group">
        <view class="form-label">昵称 <text class="required">*</text></view>
        <input 
          type="nickname"
          class="form-input" 
          placeholder="请输入您的昵称"
          value="{{userInfo.nickname}}"
          bindinput="onNicknameInput"
          maxlength="20"
        />
      </view>
    </view>

    <view class="form-actions">
      <button class="btn-primary btn-block" bindtap="nextStep">下一步</button>
    </view>
  </view>

  <!-- 步骤2: 喜好设置 -->
  <view class="step-content" wx:if="{{step === 2}}">
    <view class="step-title">设置您的喜好</view>
    <view class="step-desc">让家人了解您的偏好（可跳过）</view>

    <view class="form-section card">
      <view class="form-group">
        <view class="form-label">🎂 生日</view>
        <picker mode="date" bindchange="onDateChange" value="{{preferences.birthday}}">
          <view class="picker-value {{preferences.birthday ? '' : 'placeholder'}}">
            {{preferences.birthday || '选择您的生日'}}
          </view>
        </picker>
      </view>

      <view class="form-group">
        <view class="form-label">🍜 喜欢的食物</view>
        <input 
          class="form-input" 
          placeholder="如：火锅、寿司、西餐..."
          value="{{preferences.favoriteFood}}"
          data-field="favoriteFood"
          bindinput="onPreferenceInput"
        />
      </view>

      <view class="form-group">
        <view class="form-label">🎨 喜欢的颜色</view>
        <input 
          class="form-input" 
          placeholder="如：蓝色、粉色..."
          value="{{preferences.favoriteColor}}"
          data-field="favoriteColor"
          bindinput="onPreferenceInput"
        />
      </view>

      <view class="form-group">
        <view class="form-label">🎯 兴趣爱好</view>
        <input 
          class="form-input" 
          placeholder="如：旅行、阅读、运动..."
          value="{{preferences.hobbies}}"
          data-field="hobbies"
          bindinput="onPreferenceInput"
        />
      </view>
    </view>

    <view class="form-actions">
      <button 
        class="btn-primary btn-block" 
        bindtap="finishRegister"
        loading="{{isSubmitting}}"
        disabled="{{isSubmitting}}"
      >完成</button>
      <view class="skip-btn" bindtap="skipPreferences">跳过，以后再设置</view>
    </view>
  </view>
</view>
