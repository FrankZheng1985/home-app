<!--pages/inventory/inventory.wxml - 3Dæç®€ç§‘æŠ€ç‰ˆ-->
<view class="page-container">
  <!-- å¤´éƒ¨å±•ç¤ºåŒº -->
  <view class="hero-section">
    <view class="hero-bg-glow"></view>
    <view class="hero-content page-fade-in">
      <view class="hero-title">ç‰©èµ„æ¸…å•</view>
      <view class="hero-subtitle">Family Inventory & Shopping</view>
    </view>
  </view>

  <!-- é¡¶éƒ¨ç»Ÿè®¡/åˆ‡æ¢å¡ç‰‡ -->
  <view class="glass-card stats-card success-pop">
    <view class="tab-nav">
      <view class="tab-item {{currentTab === 'inventory' ? 'active' : ''}}" bindtap="switchTab" data-tab="inventory">
        <text>åº“å­˜ç®¡ç†</text>
        <view class="active-line" wx:if="{{currentTab === 'inventory'}}"></view>
      </view>
      <view class="tab-item {{currentTab === 'shopping' ? 'active' : ''}}" bindtap="switchTab" data-tab="shopping">
        <text>é‡‡è´­æ¸…å•</text>
        <view class="active-line" wx:if="{{currentTab === 'shopping'}}"></view>
      </view>
    </view>
  </view>

  <!-- åº“å­˜åˆ—è¡¨ -->
  <block wx:if="{{currentTab === 'inventory'}}">
    <view class="inventory-list">
      <view class="item-card glass-card" wx:for="{{inventoryItems}}" wx:key="id">
        <view class="item-icon">{{item.icon || 'ğŸ“¦'}}</view>
        <view class="item-info">
          <text class="item-name">{{item.name}}</text>
          <text class="item-category">{{item.categoryName}}</text>
        </view>
        <view class="stock-control">
          <view class="stock-btn minus btn-active-feedback" bindtap="updateStock" data-id="{{item.id}}" data-amount="-1">-</view>
          <view class="stock-value {{item.currentStock <= item.minStock ? 'low-stock' : ''}}">
            <text class="num">{{item.currentStock}}</text>
            <text class="unit">{{item.unit}}</text>
          </view>
          <view class="stock-btn plus btn-active-feedback" bindtap="updateStock" data-id="{{item.id}}" data-amount="1">+</view>
        </view>
      </view>
    </view>
    
    <!-- æ‚¬æµ®æ·»åŠ æŒ‰é’® -->
    <view class="fab-btn btn-active-feedback" bindtap="showAddItem">
      <text>+</text>
    </view>
  </block>

  <!-- é‡‡è´­æ¸…å• -->
  <block wx:if="{{currentTab === 'shopping'}}">
    <view class="shopping-list">
      <view class="shopping-item glass-card" wx:for="{{shoppingList}}" wx:key="id">
        <checkbox class="item-check" checked="{{item.status === 'bought'}}" bindtap="toggleBought" data-id="{{item.id}}" />
        <view class="shopping-info">
          <text class="shopping-name">{{item.itemName}}</text>
          <text class="shopping-meta">éœ€è´­: {{item.quantity}}{{item.unit}} Â· {{item.addedByName}}æ·»åŠ </text>
        </view>
      </view>
      
      <view class="empty-tip" wx:if="{{shoppingList.length === 0}}">
        <view class="empty-icon">ğŸ›’</view>
        <text>æ¸…å•å·²æ¸…ç©ºï¼Œç‰©èµ„å……è¶³</text>
      </view>
    </view>
  </block>

  <view class="safe-bottom"></view>

  <!-- æ·»åŠ ç‰©èµ„å¼¹çª— -->
  <view class="modal-mask {{showAddModal ? 'show' : ''}}" bindtap="hideAddModal">
    <view class="modal-content glass-card {{showAddModal ? 'show' : ''}}" catchtap="true">
      <view class="modal-header">
        <text class="modal-title">æ–°å¢ç‰©èµ„</text>
        <view class="close-btn" bindtap="hideAddModal">Ã—</view>
      </view>
      
      <scroll-view scroll-y class="modal-body">
        <view class="form-item">
          <text class="form-label">ç‰©èµ„åç§°</text>
          <input class="form-input" placeholder="è¾“å…¥åç§°ï¼Œå¦‚ï¼šç‰›å¥¶" value="{{formData.name}}" data-field="name" bindinput="onInput" />
        </view>

        <view class="form-item">
          <view class="form-label-row">
            <text class="form-label">æ‰€å±åˆ†ç±»</text>
            <text class="manage-link" bindtap="showCategoryManage">ç®¡ç†åˆ†ç±»</text>
          </view>
          <view class="category-grid">
            <view 
              wx:for="{{categories}}" 
              wx:key="id" 
              class="category-item {{formData.categoryId === item.id ? 'active' : ''}}"
              style="--cat-color: #4facfe"
              data-id="{{item.id}}"
              bindtap="onCategorySelect"
            >
              <text class="cat-icon">{{item.icon}}</text>
              <text>{{item.name}}</text>
            </view>
          </view>
        </view>

        <view class="form-row">
          <view class="form-item half">
            <text class="form-label">å½“å‰åº“å­˜</text>
            <input class="form-input" type="digit" placeholder="0" value="{{formData.currentStock}}" data-field="currentStock" bindinput="onInput" />
          </view>
          <view class="form-item half">
            <text class="form-label">é¢„è­¦é˜ˆå€¼</text>
            <input class="form-input" type="digit" placeholder="1" value="{{formData.minStock}}" data-field="minStock" bindinput="onInput" />
          </view>
        </view>

        <view class="form-row">
          <view class="form-item half">
            <text class="form-label">å•ä½</text>
            <input class="form-input" placeholder="ä¸ª/ç›’/å·" value="{{formData.unit}}" data-field="unit" bindinput="onInput" />
          </view>
        </view>

        <view class="form-item">
          <text class="form-label">å¤‡æ³¨</text>
          <textarea class="form-textarea" placeholder="å“ç‰Œã€è§„æ ¼ç­‰ä¿¡æ¯" value="{{formData.remark}}" data-field="remark" bindinput="onInput" />
        </view>
      </scroll-view>

      <view class="modal-footer">
        <view class="primary-btn submit-btn btn-active-feedback" bindtap="submitItem">
          <text>ç¡®è®¤æ·»åŠ </text>
          <view class="btn-glow"></view>
        </view>
      </view>
    </view>
  </view>

  <!-- åˆ†ç±»ç®¡ç†å¼¹çª— -->
  <view class="modal-mask {{showCategoryModal ? 'show' : ''}}" bindtap="hideCategoryModal">
    <view class="modal-content glass-card {{showCategoryModal ? 'show' : ''}}" catchtap="true">
      <view class="modal-header">
        <text class="modal-title">åˆ†ç±»ç®¡ç†</text>
        <view class="close-btn" bindtap="hideCategoryModal">Ã—</view>
      </view>
      
      <scroll-view scroll-y class="modal-body">
        <view class="category-manage-list">
          <view class="category-manage-item" wx:for="{{categories}}" wx:key="id">
            <text class="cat-icon">{{item.icon}}</text>
            <text class="cat-name">{{item.name}}</text>
            <view class="delete-icon" bindtap="deleteCategory" data-id="{{item.id}}" data-name="{{item.name}}">Ã—</view>
          </view>
        </view>

        <view class="add-category-form">
          <text class="form-label">æ·»åŠ æ–°åˆ†ç±»</text>
          <view class="form-row">
            <input class="form-input" placeholder="åˆ†ç±»åç§°" value="{{newCategory.name}}" bindinput="onNewCategoryInput" />
            <view class="primary-btn add-cat-btn btn-active-feedback" bindtap="addCategory">
              <text>æ·»åŠ </text>
            </view>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>
</view>
